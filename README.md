# ğŸ“Š å¹¿å‘ŠæŠ•æ”¾æ•°æ®æ´å¯Ÿç³»ç»Ÿ (Ads Data Insight)

ä¸€ä¸ªåŸºäº AI Agent çš„æ™ºèƒ½å¹¿å‘ŠæŠ•æ”¾æ•°æ®åˆ†æç³»ç»Ÿï¼Œèƒ½å¤Ÿè‡ªåŠ¨å¤„ç† GAID æ•°æ®å¹¶ç”Ÿæˆç²¾å‡†çš„ SQL æŸ¥è¯¢ï¼Œä¸ºå¹¿å‘ŠæŠ•æ”¾æ•ˆæœåˆ†ææä¾›æ·±åº¦æ´å¯Ÿã€‚

## ğŸš€ é¡¹ç›®åŠŸèƒ½

### æ ¸å¿ƒåŠŸèƒ½
- **æ™ºèƒ½ GAID å¤„ç†**: è‡ªåŠ¨ä» CSV æ–‡ä»¶ä¸­æå– GAID æ•°æ®ï¼Œæ ¹æ®æ•°æ®é‡æ™ºèƒ½é€‰æ‹©å¤„ç†ç­–ç•¥
- **è‡ªåŠ¨ SQL ç”Ÿæˆ**: åŸºäºç”¨æˆ·éœ€æ±‚è‡ªåŠ¨ç”Ÿæˆå¤æ‚çš„ Trino SQL æŸ¥è¯¢è¯­å¥
- **å¤šæ•°æ®æºæ”¯æŒ**: æ”¯æŒæœ¬åœ°æ–‡ä»¶ã€S3 å­˜å‚¨ç­‰å¤šç§æ•°æ®æº
- **å®æ—¶æ•°æ®åˆ†æ**: è¿æ¥ Trino æ•°æ®åº“è¿›è¡Œå®æ—¶æ•°æ®æŸ¥è¯¢å’Œåˆ†æ
- **å¯è§†åŒ–ç•Œé¢**: æä¾›å‹å¥½çš„ Streamlit Web ç•Œé¢

### ä¸šåŠ¡åœºæ™¯
- å¹¿å‘ŠæŠ•æ”¾æ•ˆæœåˆ†æ
- ç”¨æˆ·è½¬åŒ–è·¯å¾„è¿½è¸ª
- æ¸ é“æ•ˆæœå¯¹æ¯”åˆ†æ
- äº‹ä»¶æ•°æ®æ·±åº¦æŒ–æ˜

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ¶æ„æ¦‚è§ˆ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯ç•Œé¢      â”‚    â”‚   API æœåŠ¡å±‚    â”‚    â”‚   AI Agentå±‚    â”‚
â”‚  (Streamlit)    â”‚â—„â”€â”€â–ºâ”‚   (FastAPI)     â”‚â—„â”€â”€â–ºâ”‚  (Multi-Agent)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚                       â”‚
                                â–¼                       â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   æ–‡ä»¶å­˜å‚¨      â”‚    â”‚   æ•°æ®åº“è¿æ¥    â”‚
                       â”‚  (Local/S3)     â”‚    â”‚    (Trino)      â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶

#### 1. AI Agent å±‚
- **CoreAgent**: æ ¸å¿ƒåè°ƒä»£ç†ï¼Œè´Ÿè´£æ•´ä½“å·¥ä½œæµç¨‹ç¼–æ’
- **GaidAgent**: GAID æ•°æ®å¤„ç†ä¸“å®¶ï¼Œè´Ÿè´£æ•°æ®æå–å’Œé¢„å¤„ç†
- **SqlAgent**: SQL ç”Ÿæˆä¸“å®¶ï¼Œè´Ÿè´£å¤æ‚æŸ¥è¯¢è¯­å¥ç”Ÿæˆ

#### 2. API æœåŠ¡å±‚
- **FastAPI**: é«˜æ€§èƒ½å¼‚æ­¥ Web æ¡†æ¶
- **å¤šç§æ•°æ®æºæ”¯æŒ**: æ–‡ä»¶ä¸Šä¼ ã€æœ¬åœ°è·¯å¾„ã€S3 å­˜å‚¨
- **RESTful API**: æ ‡å‡†åŒ–çš„æ¥å£è®¾è®¡

#### 3. æ•°æ®å¤„ç†å±‚
- **Trino è¿æ¥**: é«˜æ€§èƒ½åˆ†å¸ƒå¼ SQL æŸ¥è¯¢å¼•æ“
- **MCP åè®®**: Model Context Protocol æ”¯æŒ
- **æ•°æ®ç¼“å­˜**: æ™ºèƒ½æ•°æ®ç¼“å­˜æœºåˆ¶

#### 4. å‰ç«¯å±•ç¤ºå±‚
- **Streamlit**: å¿«é€Ÿæ„å»ºæ•°æ®åº”ç”¨ç•Œé¢
- **å“åº”å¼è®¾è®¡**: æ”¯æŒå¤šè®¾å¤‡è®¿é—®
- **å®æ—¶åé¦ˆ**: å¤„ç†çŠ¶æ€å®æ—¶æ˜¾ç¤º

## ğŸ“‹ æ¶æ„å›¾

```mermaid
graph TB
    subgraph "ç”¨æˆ·ç•Œé¢å±‚"
        A[Streamlit Webç•Œé¢]
    end
    
    subgraph "APIæœåŠ¡å±‚"
        B[FastAPIæœåŠ¡]
        C[æ–‡ä»¶ä¸Šä¼ å¤„ç†]
        D[æ•°æ®æºç®¡ç†]
    end
    
    subgraph "AI Agentå±‚"
        E[CoreAgent<br/>æ ¸å¿ƒåè°ƒä»£ç†]
        F[GaidAgent<br/>GAIDå¤„ç†ä»£ç†]
        G[SqlAgent<br/>SQLç”Ÿæˆä»£ç†]
    end
    
    subgraph "å·¥å…·å±‚"
        H[Strands Framework]
        I[MCP Client]
        J[AWS Bedrock]
    end
    
    subgraph "æ•°æ®å±‚"
        K[Trinoæ•°æ®åº“]
        L[æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ]
        M[AWS S3å­˜å‚¨]
    end
    
    A --> B
    B --> C
    B --> D
    B --> E
    E --> F
    E --> G
    F --> H
    G --> I
    H --> J
    I --> K
    D --> L
    D --> M
    
    style E fill:#e1f5fe
    style F fill:#f3e5f5
    style G fill:#e8f5e8
    style J fill:#fff3e0
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### åç«¯æŠ€æœ¯
- **Python 3.8+**: ä¸»è¦å¼€å‘è¯­è¨€
- **FastAPI**: ç°ä»£åŒ– Web æ¡†æ¶
- **Strands**: AI Agent å¼€å‘æ¡†æ¶
- **AWS Bedrock**: å¤§è¯­è¨€æ¨¡å‹æœåŠ¡
- **Trino**: åˆ†å¸ƒå¼ SQL æŸ¥è¯¢å¼•æ“
- **MCP**: Model Context Protocol

### å‰ç«¯æŠ€æœ¯
- **Streamlit**: æ•°æ®åº”ç”¨å¿«é€Ÿå¼€å‘æ¡†æ¶
- **HTML/CSS**: ç•Œé¢ç¾åŒ–

### æ•°æ®å¤„ç†
- **Pandas**: æ•°æ®å¤„ç†å’Œåˆ†æ
- **CSV**: æ•°æ®æ–‡ä»¶æ ¼å¼
- **Boto3**: AWS SDK

### éƒ¨ç½²è¿ç»´
- **Uvicorn**: ASGI æœåŠ¡å™¨
- **Docker**: å®¹å™¨åŒ–éƒ¨ç½²ï¼ˆå¯é€‰ï¼‰
- **Shell Scripts**: è‡ªåŠ¨åŒ–è„šæœ¬

## ğŸ“¦ å®‰è£…éƒ¨ç½²

### ç¯å¢ƒè¦æ±‚
- Python 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬
- å¯è®¿é—®çš„ Trino æ•°æ®åº“
- AWS è´¦æˆ·ï¼ˆç”¨äº Bedrock æœåŠ¡ï¼‰

### å®‰è£…æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**
```bash
git clone <repository-url>
cd ads-data-insight
```

2. **å®‰è£…ä¾èµ–**
```bash
pip install -r requirements.txt
```

3. **é…ç½®æ•°æ®åº“è¿æ¥**
ç¼–è¾‘ `config/trino_config.py` æ–‡ä»¶ï¼š
```python
TRINO_CONFIG = {
    "TRINO_HOST": "your-trino-host",
    "TRINO_PORT": "8889", 
    "TRINO_USER": "your-username"
}
```

4. **é…ç½® AWS å‡­è¯**
```bash
export AWS_ACCESS_KEY_ID=your-access-key
export AWS_SECRET_ACCESS_KEY=your-secret-key
export AWS_DEFAULT_REGION=us-east-1
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å¯åŠ¨æœåŠ¡

#### æ–¹æ³•ä¸€ï¼šä½¿ç”¨è„šæœ¬å¯åŠ¨
```bash
# å¯åŠ¨åç«¯ API æœåŠ¡
./start_api.sh

# å¯åŠ¨å‰ç«¯ç•Œé¢ï¼ˆæ–°ç»ˆç«¯ï¼‰
./start_frontend.sh
```

#### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨å¯åŠ¨
```bash
# å¯åŠ¨åç«¯æœåŠ¡
python app.py

# å¯åŠ¨å‰ç«¯æœåŠ¡
streamlit run frontend/app.py --server.port 8501 --server.address 0.0.0.0
```

### è®¿é—®åº”ç”¨
- **å‰ç«¯ç•Œé¢**: http://localhost:8501
- **API æ–‡æ¡£**: http://localhost:8000/docs

### ä½¿ç”¨æµç¨‹

1. **è®¿é—® Web ç•Œé¢**
   - æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:8501

2. **è¾“å…¥å·¥å•å†…å®¹**
   ```
   1. åŒ…å:com.example.social
   2. äº‹ä»¶åç§°:install
   3. æ—¶é—´å‘¨æœŸ:20250701-20250811
   4. gaid:
   ```

3. **ä¸Šä¼  GAID æ–‡ä»¶**
   - æ”¯æŒ CSV æ ¼å¼æ–‡ä»¶
   - æ–‡ä»¶åº”åŒ…å« gaid åˆ—

4. **æäº¤åˆ†æè¯·æ±‚**
   - ç‚¹å‡»"æäº¤"æŒ‰é’®
   - ç³»ç»Ÿè‡ªåŠ¨å¤„ç†å¹¶ç”Ÿæˆç»“æœ

5. **ä¸‹è½½åˆ†æç»“æœ**
   - ç³»ç»Ÿç”Ÿæˆ CSV æ ¼å¼çš„åˆ†ææŠ¥å‘Š
   - ç‚¹å‡»ä¸‹è½½é“¾æ¥è·å–ç»“æœ

### API ä½¿ç”¨ç¤ºä¾‹

#### æ–‡ä»¶ä¸Šä¼ æ–¹å¼
```bash
curl -X POST "http://localhost:8000/data-query/upload-file" \
  -F "user_input=åŒ…å:com.example.social äº‹ä»¶åç§°:install æ—¶é—´å‘¨æœŸ:20250701-20250811" \
  -F "file=@your-gaid-file.csv"
```

#### æ–‡ä»¶è·¯å¾„æ–¹å¼
```bash
curl -X POST "http://localhost:8000/data-query/file-path" \
  -F "user_input=åŒ…å:com.example.social äº‹ä»¶åç§°:install æ—¶é—´å‘¨æœŸ:20250701-20250811" \
  -F "file_path=/path/to/your/file.csv"
```

#### S3 è·¯å¾„æ–¹å¼
```bash
curl -X POST "http://localhost:8000/data-query/s3-path" \
  -F "user_input=åŒ…å:com.example.social äº‹ä»¶åç§°:install æ—¶é—´å‘¨æœŸ:20250701-20250811" \
  -F "s3_path=s3://your-bucket/your-file.csv"
```

## ğŸ“Š æ•°æ®è¡¨ç»“æ„

ç³»ç»Ÿæ”¯æŒä»¥ä¸‹æ•°æ®è¡¨æŸ¥è¯¢ï¼š

### t_conversion1 (å®‰è£…è½¬åŒ–è¡¨)
- `dt`: æ—¥æœŸ
- `pkg_name`: åŒ…å
- `second_channel`: äºŒçº§æ¸ é“
- `affiliate_id`: è”ç›ŸID
- `nation`: å›½å®¶
- `gaid`: Google å¹¿å‘ŠID

### t_conversion2 (æ‹’ç»è½¬åŒ–è¡¨)
- å­—æ®µç»“æ„åŒ t_conversion1

### t_event (äº‹ä»¶è¡¨)
- `dt`: æ—¥æœŸ
- `pkg_name`: åŒ…å
- `second_channel`: äºŒçº§æ¸ é“
- `affiliate_id`: è”ç›ŸID
- `nation`: å›½å®¶
- `event_name`: äº‹ä»¶åç§°
- `gaid`: Google å¹¿å‘ŠID

## ğŸ”§ é…ç½®è¯´æ˜

### æ—¥å¿—é…ç½®
ç³»ç»Ÿä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—è®°å½•ï¼Œé…ç½®æ–‡ä»¶ä½äº `config/logger_config.py`

### æ•°æ®åº“é…ç½®
Trino è¿æ¥é…ç½®ä½äº `config/trino_config.py`

### MCP æœåŠ¡å™¨é…ç½®
SQL Agent ä½¿ç”¨ MCP åè®®è¿æ¥ Trinoï¼Œé…ç½®è·¯å¾„ï¼š`/data/mcp-trino-python/src/server_stdio.py`

## ğŸ§ª æµ‹è¯•

### è¿è¡Œæµ‹è¯•
```bash
# API æµ‹è¯•
python test_api_client.py

# åŠŸèƒ½æµ‹è¯•
python test.py
```

### æµ‹è¯•è„šæœ¬
- `test_api_client.py`: API æ¥å£æµ‹è¯•
- `test.py`: æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•

## ğŸ“ å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„
```
ads-data-insight/
â”œâ”€â”€ agent/              # AI Agent æ¨¡å—
â”‚   â”œâ”€â”€ core_agent.py   # æ ¸å¿ƒåè°ƒä»£ç†
â”‚   â”œâ”€â”€ gaid_agent.py   # GAID å¤„ç†ä»£ç†
â”‚   â””â”€â”€ sql_agent.py    # SQL ç”Ÿæˆä»£ç†
â”œâ”€â”€ api/                # API æœåŠ¡æ¨¡å—
â”‚   â”œâ”€â”€ main.py         # FastAPI ä¸»åº”ç”¨
â”‚   â””â”€â”€ data_query.py   # æ•°æ®æŸ¥è¯¢è·¯ç”±
â”œâ”€â”€ config/             # é…ç½®æ¨¡å—
â”‚   â”œâ”€â”€ logger_config.py # æ—¥å¿—é…ç½®
â”‚   â””â”€â”€ trino_config.py  # æ•°æ®åº“é…ç½®
â”œâ”€â”€ frontend/           # å‰ç«¯ç•Œé¢
â”‚   â””â”€â”€ app.py          # Streamlit åº”ç”¨
â”œâ”€â”€ data/               # æ•°æ®æ–‡ä»¶ç›®å½•
â”œâ”€â”€ output/             # è¾“å‡ºç»“æœç›®å½•
â””â”€â”€ requirement/        # éœ€æ±‚æ–‡æ¡£
```

### æ‰©å±•å¼€å‘
1. **æ·»åŠ æ–°çš„ Agent**: åœ¨ `agent/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„ä»£ç†ç±»
2. **æ‰©å±• API**: åœ¨ `api/data_query.py` ä¸­æ·»åŠ æ–°çš„è·¯ç”±
3. **è‡ªå®šä¹‰ç•Œé¢**: ä¿®æ”¹ `frontend/app.py` æ·»åŠ æ–°åŠŸèƒ½

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- æäº¤ Issue
- å‘é€é‚®ä»¶è‡³é¡¹ç›®ç»´æŠ¤è€…

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®çš„æ”¯æŒï¼š
- [FastAPI](https://fastapi.tiangolo.com/)
- [Streamlit](https://streamlit.io/)
- [Strands](https://github.com/strands-ai/strands)
- [AWS Bedrock](https://aws.amazon.com/bedrock/)
- [Trino](https://trino.io/)

---

**æ³¨æ„**: è¯·ç¡®ä¿åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¦¥å–„é…ç½®å®‰å…¨è®¾ç½®å’Œè®¿é—®æ§åˆ¶ã€‚